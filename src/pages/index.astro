---
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import SpotifyNowPlaying from '../components/SpotifyNowPlaying.astro';
import GalleryOverlay from '../components/GalleryOverlay.astro';
import FriendsOverlay from '../components/FriendsOverlay.astro'; // <-- Importieren
---

<Layout title="Nerozhen | Portfolio">
  <div class="main-grid">
    <div class="status-widgets">
      <SpotifyNowPlaying />
    </div>
    <Card />
  </div>
  
  <GalleryOverlay />
  <FriendsOverlay /> <!-- <-- Hier einf체gen -->
</Layout>

<script>
  function setupOverlay(buttonId, overlayId) {
    // ... (Diese Funktion bleibt unver채ndert)
    const openButton = document.getElementById(buttonId);
    const overlay = document.getElementById(overlayId);

    if (openButton && overlay) {
      const closeButton = overlay.querySelector(".close-button");
      const openFunc = () => overlay.classList.add("active");
      const closeFunc = () => overlay.classList.remove("active");

      openButton.addEventListener("click", openFunc);
      if (closeButton) closeButton.addEventListener("click", closeFunc);
      
      overlay.addEventListener("click", (event) => {
        if (event.target === overlay) closeFunc();
      });
    }
  }

  function setupGallery() {
    // ... (Diese Funktion bleibt unver채ndert)
    const galleryGrid = document.querySelector("#gallery-overlay .gallery-grid");
    const lightbox = document.getElementById("image-lightbox");

    if (!galleryGrid || !lightbox) return;

    const lightboxImg = lightbox.querySelector(".lightbox-content");
    const closeLightboxButton = lightbox.querySelector(".lightbox-close");

    const openLightbox = (imageElement) => {
      if (imageElement) {
        lightboxImg.src = imageElement.src;
        lightbox.classList.add("active");
      }
    }
    
    const closeLightbox = () => lightbox.classList.remove("active");
    
    if (closeLightboxButton) closeLightboxButton.addEventListener("click", closeLightbox);
    lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) closeLightbox();
    });

    galleryGrid.addEventListener("click", (event) => {
        const item = event.target.closest(".gallery-item");
        if (!item) return;

        const imageElement = item.querySelector("img");
        const isSpoiler = item.dataset.spoiler === "true";
        const isRevealed = item.classList.contains("revealed");

        if (isSpoiler && !isRevealed) {
            item.classList.add("revealed");
        } else {
            openLightbox(imageElement);
        }
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    setupOverlay("open-gallery-modal", "gallery-overlay");
    setupOverlay("open-friends-modal", "friends-overlay"); // <-- Zeile hinzuf체gen
    setupGallery();
  });
</script>

<style>
  .main-grid {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 30px;
  }
  .status-widgets {
      width: 100%;
      max-width: 450px;
  }
</style>

